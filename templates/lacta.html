
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Conte√∫do - Lacta</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
    <body>
        <div class="container">
            <!-- T√≠tulo principal -->
            <h1>Lacta Content Generator</h1>
    
            <!-- Se√ß√£o de formul√°rio para configura√ß√£o da campanha -->
            <form action="{{ url_for('lacta') }}" method="post">
                <!-- Campo de busca para a localiza√ß√£o -->
                <div class="form-group" style="position:relative;">
                    <label for="localizacao">Localiza√ß√£o</label>
                    <input type="text" id="localizacao" placeholder="Digite Estado, Cidade ou Bairro" autocomplete="off" required>
                    <ul id="suggestions" style="position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #ccc; list-style:none; padding:0; margin:0; display:none;">
                        <!-- Sugest√µes ser√£o geradas aqui dinamicamente -->
                    </ul>
                </div>
            
                <!-- Campos ocultos que ser√£o preenchidos dinamicamente -->
                <input type="hidden" id="estado" name="estado">
                <input type="hidden" id="cidade" name="cidade">
                <input type="hidden" id="bairro" name="bairro">


                <!-- Aqui est√° o fechamento da div corrigido -->
                <div class="form-group">
                    <label for="loja">Lojas</label>
                    <select id="loja" name="loja" required>
                        <option value="" disabled selected>Selecione a Loja</option>
                        <option value="Store 1">Loja 1</option>
                        <option value="Store 2">Loja 2</option>
                    </select>
                </div>
    
                <!-- Linha de datas de campanha (in√≠cio e t√©rmino) -->
                <div class="form-group">
                    <label for="data_campanha">Per√≠odo da Campanha</label>
                    <input type="text" id="data_campanha" class="datepicker" name="data_campanha" placeholder="Selecione o intervalo de datas" required>
                </div>
                    
                <!-- Se√ß√£o de sele√ß√£o de hor√°rios -->
                <div class="form-group">
                    <label>Momento de consumo</label>
                    <div class="time-ranges">
                        <label><input type="checkbox" name="time_range" value="early_morning"> Manh√£ / Caf√© da manh√£ </label>
                        <label><input type="checkbox" name="time_range" value="before_lunch"> Antes do almo√ßo </label>
                        <label><input type="checkbox" name="time_range" value="after_lunch"> Depois do almo√ßo </label>
                        <label><input type="checkbox" name="time_range" value="afternoon"> Tarde </label>
                        <label><input type="checkbox" name="time_range" value="happy_hour"> Happy Hour </label>
                        <label><input type="checkbox" name="time_range" value="dinner"> Jantar </label>
                        <label><input type="checkbox" name="time_range" value="late_night"> Noite </label>
                    </div>
                </div>
    
                <!-- Dados em tempo real -->
                <div class="real-time-data">
                    <button class="data-button" data-type="weather">üå§Ô∏è Weather<br><span>{{ real_time_date.weather if real_time_date else "Loading..." }}</span></button>
                    <button class="data-button" data-type="trending">#Ô∏è‚É£ Trending<br><span>{{ real_time_date.trending if real_time_date else "Loading..." }}</span></button>
                    <button class="data-button" data-type="local-events">üìÖ Local Events<br><span>{{ real_time_date.local_events if real_time_date else "Loading..." }}</span></button>
                    <button class="data-button" data-type="pop-culture">üé¨ Pop Culture<br><span>{{ real_time_date.pop_culture if real_time_date else "Loading..." }}</span></button>
                </div>                
    
                <!-- Bot√£o para gerar conte√∫do -->
                <button type="submit">Generate Content</button>
            </form>
    
            <form action="avaliados" method="post">
                <button type="submit">Acessar slogans</button>
            </form>

            <!-- Se√ß√£o de op√ß√µes criativas de slogans -->
            <h2>Op√ß√µes Criativas</h2>
            <div class="slogan-options">
                {% if slogans_imagens %}
                    {% for slogan, imagem in slogans_imagens %}
                        <div class="slogan-box">
                            <h3>{{ slogan }}</h3>
                            <img src="{{ url_for('static', filename=imagem) }}" alt="{{ slogan }}" class="slogan-image">
                            
                            <!-- Bot√µes de avalia√ß√£o e edi√ß√£o -->
                            <div class="slogan-controls">
                                <button class="like-button" data-imagem="{{ imagem }}" data-avaliacao="like">üëç</button>
                                <button class="dislike-button" data-imagem="{{ imagem }}" data-avaliacao="dislike">üëé</button>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Conte√∫do n√£o gerado ainda. Preencha o formul√°rio e gere conte√∫do.</p>
                {% endif %}
            </div>
        </div>
        
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const input = document.getElementById('localizacao');
                const suggestions = document.getElementById('suggestions');
                const estadoInput = document.getElementById('estado');
                const cidadeInput = document.getElementById('cidade');
                const bairroInput = document.getElementById('bairro');
        
                // Carregar os dados do JSON
                fetch('/static/data/estados_cidades_bairros.json')
                    .then(response => response.json())
                    .then(data => {
                        // Atualizar sugest√µes conforme o usu√°rio digita
                        input.addEventListener('input', () => {
                            const query = input.value.toLowerCase();
                            suggestions.innerHTML = ''; // Limpa sugest√µes anteriores
        
                            if (query.length < 2) {
                                suggestions.style.display = 'none';
                                return;
                            }
        
                            // Filtrar os dados para encontrar correspond√™ncias
                            const matches = [];
                            for (const [estado, cidades] of Object.entries(data)) {
                                for (const [cidade, bairros] of Object.entries(cidades)) {
                                    if (estado.toLowerCase().includes(query) || cidade.toLowerCase().includes(query)) {
                                        matches.push(`${estado} - ${cidade}`);
                                    }
                                    bairros.forEach(bairro => {
                                        if (bairro.toLowerCase().includes(query)) {
                                            matches.push(`${estado} - ${cidade} - ${bairro}`);
                                        }
                                    });
                                }
                            }
        
                            // Exibir as sugest√µes encontradas
                            if (matches.length > 0) {
                                matches.forEach(match => {
                                    const li = document.createElement('li');
                                    li.textContent = match;
                                    li.style.padding = '8px';
                                    li.style.cursor = 'pointer';
                                    li.addEventListener('click', () => {
                                        input.value = match;
                                        suggestions.style.display = 'none';
        
                                        // Preencher os campos ocultos
                                        const parts = match.split(' - ');
                                        estadoInput.value = parts[0] || '';
                                        cidadeInput.value = parts[1] || '';
                                        bairroInput.value = parts[2] || '';
                                    });
                                    suggestions.appendChild(li);
                                });
                                suggestions.style.display = 'block';
                            } else {
                                suggestions.style.display = 'none';
                            }
                        });
        
                        // Esconder as sugest√µes ao clicar fora
                        document.addEventListener('click', (e) => {
                            if (!e.target.closest('.form-group')) {
                                suggestions.style.display = 'none';
                            }
                        });
                    })
                    .catch(error => console.error('Erro ao carregar os dados:', error));
            });
        </script>
        

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                flatpickr("#data_campanha", {
                    mode: "range", // Permite selecionar um intervalo de datas
                    dateFormat: "d/m/Y", // Formato da data
                    minDate: "today", // Come√ßa a partir de hoje
                    locale: {
                        firstDayOfWeek: 0, // Domingo como o primeiro dia
                        weekdays: {
                            shorthand: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "S√°b"],
                            longhand: ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"]
                        },
                        months: {
                            shorthand: ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"],
                            longhand: ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"]
                        }
                    },
                    onChange: function(selectedDates, dateStr, instance) {
                        console.log("Datas selecionadas:", dateStr); // Retorna o intervalo no formato escolhido
                    }
                });
            });
        </script>
        
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const estadoSelect = document.getElementById('estado');
            const cidadeSelect = document.getElementById('cidade');
            const bairroSelect = document.getElementById('bairro');

            // Carregar JSON de estados, cidades e bairros
            fetch('/static/data/estados_cidades_bairros.json')
                .then(response => response.json())
                .then(data => {
                    // Preencher estados
                    Object.keys(data).forEach(estado => {
                        const option = document.createElement('option');
                        option.value = estado;
                        option.textContent = estado;
                        estadoSelect.appendChild(option);
                    });

                    // Quando o estado for selecionado
                    estadoSelect.addEventListener('change', function () {
                        const estadoSelecionado = this.value;
                        cidadeSelect.innerHTML = '<option selected disabled>Selecione a Cidade</option>';
                        bairroSelect.innerHTML = '<option selected disabled>Selecione o Bairro</option>';

                        // Preencher cidades do estado selecionado
                        Object.keys(data[estadoSelecionado]).forEach(cidade => {
                            const option = document.createElement('option');
                            option.value = cidade;
                            option.textContent = cidade;
                            cidadeSelect.appendChild(option);
                        });
                    });

                    // Quando a cidade for selecionada
                    cidadeSelect.addEventListener('change', function () {
                        const estadoSelecionado = estadoSelect.value;
                        const cidadeSelecionada = this.value;
                        bairroSelect.innerHTML = '<option selected disabled>Selecione o Bairro</option>';

                        // Preencher bairros da cidade selecionada
                        data[estadoSelecionado][cidadeSelecionada].forEach(bairro => {
                            const option = document.createElement('option');
                            option.value = bairro;
                            option.textContent = bairro;
                            bairroSelect.appendChild(option);
                        });
                    });
                })
                .catch(error => console.error('Erro ao carregar os dados:', error));
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar evento aos bot√µes de like/dislike
            document.querySelectorAll('.like-button, .dislike-button').forEach(button => {
                button.addEventListener('click', function() {
                    const imagem = this.getAttribute('data-imagem');
                    const avaliacao = this.getAttribute('data-avaliacao');
                    
                    // Enviar os dados via Fetch
                    fetch('/avaliar_slogan', {
                        method: 'POST',
                        body: new URLSearchParams({
                            'slogan_image': imagem,
                            'avaliacao': avaliacao
                        }),
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Exibir uma mensagem de sucesso
                            alert(data.message);

                            // Atualizar as listas de like e dislike na p√°gina
                            // Se voc√™ tiver elementos de exibi√ß√£o dos likes e dislikes, atualize-os aqui.
                            console.log('Likes:', data.likes);
                            console.log('Dislikes:', data.dislikes);
                        } else {
                            alert("Erro ao avaliar slogan");
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao avaliar slogan:', error);
                    });
                });
            });
        });

    </script>

</body>
</html>